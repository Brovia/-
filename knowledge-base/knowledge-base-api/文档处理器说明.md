# LangChain文档处理器说明

## 概述

档描述知识库系统的文档处理服务，系统已完全基于LangChain框架实现。系统现在使用统一的LangChain文档处理器，提供强大的文档处理能力。

## 主要改进

### 1. 文档加载能力
- 支持多种文档格式（Markdown、文本文件等）
- 使用LangChain的`UnstructuredMarkdownLoader`和`TextLoader`
- 更好的文档解析和元数据提取

### 2. 智能的文本分割
- 使用LangChain的`RecursiveCharacterTextSplitter`
- 支持中文友好的分割符：`["\n\n", "\n", "。", "！", "？", "；", " ", ""]`
- 更精确的文本块分割，保持语义完整性

### 3. 简化的处理器接口
- `DocumentProcessor`类提供统一的LangChain接口
- 直接使用LangChain的强大功能

## 配置说明

### 环境变量配置

在`.env`文件中添加以下配置：

```env
# 文档处理配置
DOCUMENT_CHUNK_SIZE=1000
DOCUMENT_CHUNK_OVERLAP=200
DOCUMENT_SEPARATORS=["\n\n", "\n", "。", "！", "？", "；", " ", ""]
```

### 配置参数说明

- `DOCUMENT_CHUNK_SIZE`: 文本块大小（默认：1000字符）
- `DOCUMENT_CHUNK_OVERLAP`: 文本块重叠大小（默认：200字符）
- `DOCUMENT_SEPARATORS`: 文本分割符列表

## 使用方法

### 1. 基本使用

```python
from app.services.document_processor import DocumentProcessor

# 使用默认配置
processor = DocumentProcessor()

# 使用自定义参数
processor = DocumentProcessor(
    chunk_size=500,
    chunk_overlap=100,
    separators=["\n\n", "\n", "。", "！", "？"]
)
```

### 2. 处理单个文件

```python
# 处理Markdown文件
result = processor.process_file("path/to/document.md")

print(f"标题: {result['title']}")
print(f"内容长度: {len(result['content'])}")
print(f"块数量: {len(result['chunks'])}")
print(f"元数据: {result['metadata']}")
```

### 3. 批量处理目录

```python
# 批量处理目录中的所有Markdown文件
results = processor.batch_process_directory("./data/documents", "*.md")

print(f"处理了 {len(results)} 个文档")
```

### 4. 获取处理器信息

```python
info = processor.get_processor_info()
print(f"处理器类型: {info['type']}")
print(f"块大小: {info['chunk_size']}")
print(f"块重叠: {info['chunk_overlap']}")
```

## 迁移步骤

### 1. 安装依赖

```bash
pip install -r requirements.txt
```

### 2. 更新代码

系统已完全基于LangChain实现，直接使用`DocumentProcessor`：

```python
from app.services.document_processor import DocumentProcessor
processor = DocumentProcessor()
```

### 3. 测试验证

## 故障排除

### 1. 导入错误

如果遇到`ModuleNotFoundError: No module named 'langchain'`错误：

```bash
pip install langchain langchain-community langchain-chroma langchain-openai unstructured
```

### 2. 文档加载失败

如果遇到`No module named 'unstructured'`错误：

```bash
pip install unstructured
```