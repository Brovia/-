import{h as E,U as N,Y as P,j as A,z as u,A as i,B as s,I as F,L as I,R as e,J as n,O as m,u as a,al as l,P as _,Q as M,a5 as U,ax as j,D as J}from"./vendor-CBsB69ib.js";import{r as O,d as Q,e as R,g as T}from"./element-CPMJgIwH.js";import{u as Y}from"./dashboard-BL77ydzG.js";import{_ as q}from"./index-DuDiLGTc.js";import"./api-BTqAopYE.js";import"./axios-ngrFHoWO.js";const G={class:"dashboard-page"},H={class:"page-header"},K={class:"header-content"},W={class:"header-actions"},X={class:"stat-card stat-card-primary"},Z={class:"stat-icon"},$={class:"stat-content"},ss={class:"stat-number"},ts={class:"stat-card stat-card-success"},as={class:"stat-icon"},es={class:"stat-content"},os={class:"stat-number"},ns={class:"stat-card stat-card-warning"},ds={class:"stat-icon"},ls={class:"stat-content"},rs={class:"stat-number"},cs={class:"providers-card"},is={key:0,class:"providers-list"},_s={class:"provider-info"},us={class:"provider-name"},hs={class:"provider-stats"},ps={class:"provider-count"},vs={class:"provider-percentage"},ms={key:1,class:"empty-providers"},gs={__name:"Dashboard",setup(bs){const r=Y(),{stats:c,isLoading:y,hasError:D,errorMessage:w,fetchStats:k,refreshStats:C,getProviderPercentage:g,getProviderCount:x,getProviderColor:b}=r,h=async(d=!1)=>{if(console.log("[Dashboard] 检查缓存状态:",{hasData:r.hasData,isCacheValid:r.isCacheValid,stats:r.stats,forceRefresh:d}),d||!r.hasData||!r.isCacheValid)try{console.log("[Dashboard] 重新加载数据"),await k(!0)}catch(t){console.error("Failed to load dashboard data:",t)}else console.log("[Dashboard] 使用缓存数据，无需重新加载")};E(async()=>{await h();const d=()=>{console.log("[Dashboard] 收到数据变化通知，强制重新加载数据"),h(!0)};window.addEventListener("dashboard-data-changed",d),N(()=>{window.removeEventListener("dashboard-data-changed",d)})}),P(async()=>{console.log("[Dashboard] 组件激活，强制重新加载数据"),await h(!0)});const S=j();return A(()=>S.path,(d,t)=>{d==="/dashboard"&&t&&t!=="/dashboard"&&(console.log("[Dashboard] 路由切换到仪表盘，强制重新加载数据"),h(!0))}),(d,t)=>{const V=l("el-button"),B=l("el-alert"),v=l("el-icon"),p=l("el-col"),f=l("el-row"),L=l("el-progress"),z=l("el-empty");return i(),u("div",G,[s("div",H,[s("div",K,[t[1]||(t[1]=s("div",{class:"header-text"},[s("h2",null,"仪表盘"),s("p",null,"知识库系统概览和统计信息")],-1)),s("div",W,[e(V,{type:"primary",icon:a(O),loading:a(y),onClick:a(C),size:"small"},{default:n(()=>[...t[0]||(t[0]=[m(" 刷新数据 ",-1)])]),_:1},8,["icon","loading","onClick"])])])]),a(D)?(i(),F(B,{key:0,title:a(w),type:"error",closable:!1,"show-icon":"",class:"error-alert"},null,8,["title"])):I("",!0),e(f,{gutter:24,class:"stats-row"},{default:n(()=>[e(p,{span:8},{default:n(()=>[s("div",X,[s("div",Z,[e(v,null,{default:n(()=>[e(a(Q))]),_:1})]),s("div",$,[t[2]||(t[2]=s("div",{class:"stat-label"},"文档总数",-1)),s("div",ss,_(a(c).total_documents||0),1)])])]),_:1}),e(p,{span:8},{default:n(()=>[s("div",ts,[s("div",as,[e(v,null,{default:n(()=>[e(a(R))]),_:1})]),s("div",es,[t[3]||(t[3]=s("div",{class:"stat-label"},"文本块数",-1)),s("div",os,_(a(c).total_chunks||0),1)])])]),_:1}),e(p,{span:8},{default:n(()=>{var o;return[s("div",ns,[s("div",ds,[e(v,null,{default:n(()=>[e(a(T))]),_:1})]),s("div",ls,[t[4]||(t[4]=s("div",{class:"stat-label"},"云服务商",-1)),s("div",rs,_(((o=a(c).providers)==null?void 0:o.length)||0),1)])])]}),_:1})]),_:1}),e(f,{gutter:24},{default:n(()=>[e(p,{span:24},{default:n(()=>[s("div",cs,[t[6]||(t[6]=s("div",{class:"card-header"},[s("h3",null,"云服务商分布"),s("span",{class:"card-subtitle"},"各云服务商的文档块分布情况")],-1)),a(c).providers&&a(c).providers.length>0?(i(),u("div",is,[(i(!0),u(M,null,U(a(c).providers,o=>(i(),u("div",{key:o,class:"provider-item"},[s("div",_s,[s("div",us,[s("span",{class:"provider-badge",style:J({backgroundColor:a(b)(o)})},null,4),m(" "+_(o),1)]),s("div",hs,[s("span",ps,_(a(x)(o)),1),t[5]||(t[5]=m(" 个文档块 ",-1)),s("span",vs,_(a(g)(o))+"%",1)])]),e(L,{percentage:a(g)(o),color:a(b)(o),"stroke-width":8},null,8,["percentage","color"])]))),128))])):(i(),u("div",ms,[e(z,{description:"暂无数据","image-size":100})]))])]),_:1})]),_:1})])}}},xs=q(gs,[["__scopeId","data-v-89c107b3"]]);export{xs as default};
