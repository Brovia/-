import{r as d,c as I,h as Be,z as f,A as v,B as s,R as a,J as o,al as p,u as y,O as u,E as U,P as r,Q as K,a5 as q,K as Ae,L as V,ar as Te,I as G,aB as Ee,D as Ne}from"./vendor-CBsB69ib.js";import{s as Le,u as Me,r as Ie,d as oe,v as ne,w as Ue,l as b,x as se,y as Ge,f as Re}from"./element-CPMJgIwH.js";import{u as We}from"./dashboard-BL77ydzG.js";import{a as J}from"./api-BTqAopYE.js";import{_ as je}from"./index-DuDiLGTc.js";import"./axios-ngrFHoWO.js";const Ke={class:"documents-page"},qe={class:"card"},Je={class:"action-buttons"},Oe={class:"main-content"},Qe={class:"tree-view"},He={class:"directory-tree"},Xe={class:"tree-content"},Ye={class:"document-count"},Ze=["onClick"],et={class:"provider-name"},tt={class:"document-count"},at={key:0,class:"products-list"},lt=["onClick"],ot={class:"product-emoji"},nt={class:"product-name"},st={class:"document-count"},rt={class:"documents-list"},ut={class:"list-header"},ct={class:"header-left"},it={class:"document-count"},dt={key:0,class:"header-right"},vt={class:"selected-count"},mt={class:"file-info"},pt={class:"file-name"},ft={key:1},_t={key:1},gt={class:"pagination-wrapper"},ht={key:0,class:"document-detail"},yt={key:0,class:"source-url"},bt={key:1,class:"document-tags"},wt={__name:"Documents",setup(Ct){const re=Ee(),O=We(),B=d(!1),D=d([]),A=d(""),T=d(""),E=d(""),N=d(!1),c=d(null),m=d([]),R=d(!1);d("tree");const _=d({name:"æ‰€æœ‰æ–‡æ¡£",path:[]}),P=d([{name:"è´Ÿè½½å‡è¡¡",icon:"âš–ï¸",color:"#52c41a"},{name:"ç§æœ‰ç½‘ç»œ",icon:"ðŸŒ",color:"#1890ff"},{name:"å¼¹æ€§IP",icon:"ðŸ”—",color:"#722ed1"},{name:"NATç½‘å…³",icon:"ðŸšª",color:"#fa8c16"},{name:"ä¸“çº¿",icon:"ðŸ”Œ",color:"#eb2f96"},{name:"äº‘è”ç½‘",icon:"ðŸŒ",color:"#13c2c2"},{name:"VPN",icon:"ðŸ”’",color:"#f5222d"}]),ue=d([{name:"è…¾è®¯äº‘",color:"#006EFF",products:P.value},{name:"é˜¿é‡Œäº‘",color:"#FF6A00",products:P.value},{name:"ç«å±±äº‘",color:"#FF4D4F",products:P.value},{name:"åŽä¸ºäº‘",color:"#FF6900",products:P.value},{name:"AWS",color:"#FF9900",products:P.value},{name:"Azure",color:"#0078D4",products:P.value},{name:"GCP",color:"#4285F4",products:P.value}]),S=d(new Set),z=d(1),$=d(20),L=d(0),Q=I(()=>{let t=D.value;if(A.value){const e=A.value.toLowerCase();t=t.filter(n=>n.filename.toLowerCase().includes(e)||n.title.toLowerCase().includes(e)||n.provider&&n.provider.toLowerCase().includes(e)||n.category&&n.category.toLowerCase().includes(e))}if(T.value&&(t=t.filter(e=>e.provider===T.value)),E.value&&(t=t.filter(e=>e.category===E.value)),_.value.path.length>0){const e=_.value.path[0];if(_.value.path.length===1)t=t.filter(n=>n.provider===e);else if(_.value.path.length===2){const n=_.value.path[1];t=t.filter(C=>C.provider===e&&C.category===n)}}return t}),ce=I(()=>{const t=(z.value-1)*$.value,e=t+$.value;return Q.value.slice(t,e)}),H=I(()=>Q.value.length),M=async(t=!1)=>{try{B.value=!0;const e=await J.getDocuments({skip:0,limit:1e3},{showLoading:t});if(e&&e.status===200){const n=e.data||{};D.value=n.documents||[],L.value=n.total||0,console.log("Fetched documents:",D.value.length,"ä¸ªæ–‡æ¡£ï¼Œæ€»è®¡:",L.value)}else{const n=await e.json();b.error(`èŽ·å–æ–‡æ¡£åˆ—è¡¨å¤±è´¥: ${n.detail||"æœªçŸ¥é”™è¯¯"}`),D.value=[],L.value=0}}catch(e){b.error("èŽ·å–æ–‡æ¡£åˆ—è¡¨å¤±è´¥"),console.error("Fetch documents error:",e),D.value=[],L.value=0}finally{B.value=!1}},ie=()=>{_.value={name:"æ‰€æœ‰æ–‡æ¡£",path:[]},m.value=[]},de=t=>{S.value.has(t.name)?S.value.delete(t.name):S.value.add(t.name),_.value={name:t.name,path:[t.name]},m.value=[]},ve=(t,e)=>{_.value={name:`${t.name} - ${e.name}`,path:[t.name,e.name]},m.value=[]},X=I(()=>{const t={byProvider:{},byProduct:{}};return D.value.forEach(e=>{if(e.provider&&(t.byProvider[e.provider]=(t.byProvider[e.provider]||0)+1),e.provider&&e.category){const n=`${e.provider}:${e.category}`;t.byProduct[n]=(t.byProduct[n]||0)+1}}),t}),me=t=>X.value.byProvider[t]||0,pe=(t,e)=>{const n=`${t}:${e}`;return X.value.byProduct[n]||0},fe=async()=>{await M(!0),b.success("æ–‡æ¡£åˆ—è¡¨å·²åˆ·æ–°")},_e=()=>{z.value=1,m.value=[]},Y=()=>{z.value=1,m.value=[]},ge=t=>{c.value=t,N.value=!0},W=()=>{N.value=!1,c.value=null},he=async t=>{try{await se.confirm(`ç¡®å®šè¦åˆ é™¤æ–‡æ¡£ "${t.filename}" å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚`,"ç¡®è®¤åˆ é™¤",{confirmButtonText:"åˆ é™¤",cancelButtonText:"å–æ¶ˆ",type:"warning"});const e=await J.deleteDocument(t.id);if(e&&e.status===200){const n=e.data||{};b.success(`æ–‡æ¡£åˆ é™¤æˆåŠŸ: ${n.filename}`),O.markForRefresh(),window.dispatchEvent(new CustomEvent("dashboard-data-changed")),await M(!1)}else b.error("åˆ é™¤æ–‡æ¡£å¤±è´¥: æœªçŸ¥é”™è¯¯")}catch(e){e!=="cancel"&&(b.error("åˆ é™¤æ–‡æ¡£å¤±è´¥"),console.error("Delete document error:",e))}},ye=()=>{c.value&&(W(),re.push({path:"/search",query:{q:c.value.title}}))},be=t=>{$.value=t,z.value=1,m.value=[]},we=t=>{z.value=t,m.value=[]},Ce=t=>{m.value=t},ke=async()=>{if(m.value.length===0){b.warning("è¯·å…ˆé€‰æ‹©è¦åˆ é™¤çš„æ–‡æ¡£");return}try{await se.confirm(`ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„ ${m.value.length} ä¸ªæ–‡æ¡£å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚`,"ç¡®è®¤æ‰¹é‡åˆ é™¤",{confirmButtonText:"åˆ é™¤",cancelButtonText:"å–æ¶ˆ",type:"warning"}),R.value=!0;const t=m.value.map(g=>J.deleteDocument(g.id)),e=await Promise.allSettled(t);let n=0,C=0;e.forEach((g,i)=>{g.status==="fulfilled"&&g.value&&g.value.status===200?n++:(C++,console.error(`åˆ é™¤æ–‡æ¡£å¤±è´¥: ${m.value[i].filename}`,g.reason))}),n>0&&(b.success(`æˆåŠŸåˆ é™¤ ${n} ä¸ªæ–‡æ¡£`),O.markForRefresh(),window.dispatchEvent(new CustomEvent("dashboard-data-changed")),await M(!1)),C>0&&b.error(`${C} ä¸ªæ–‡æ¡£åˆ é™¤å¤±è´¥`),m.value=[]}catch(t){t!=="cancel"&&(b.error("æ‰¹é‡åˆ é™¤å¤±è´¥"),console.error("Batch delete error:",t))}finally{R.value=!1}},Z=t=>{if(!t)return"-";const e=["B","KB","MB","GB"],n=Math.floor(Math.log(t)/Math.log(1024));return Math.round(t/Math.pow(1024,n)*100)/100+" "+e[n]},j=t=>t?new Date(t).toLocaleString("zh-CN"):"-",De=t=>({è…¾è®¯äº‘:"primary",é˜¿é‡Œäº‘:"success",ç«å±±äº‘:"danger",åŽä¸ºäº‘:"danger",AWS:"warning",Azure:"info",GCP:"info"})[t]||"info",ee=t=>({pending:"info",processing:"warning",processed:"success",failed:"danger"})[t]||"info",te=t=>({pending:"å¾…å¤„ç†",processing:"å¤„ç†ä¸­",processed:"å·²å¤„ç†",failed:"å¤„ç†å¤±è´¥"})[t]||"æœªçŸ¥";return Be(async()=>{await M(!1)}),(t,e)=>{var le;const n=p("el-icon"),C=p("el-input"),g=p("el-col"),i=p("el-option"),ae=p("el-select"),x=p("el-button"),Pe=p("el-row"),h=p("el-table-column"),F=p("el-tag"),ze=p("el-table"),xe=p("el-pagination"),k=p("el-descriptions-item"),Se=p("el-descriptions"),$e=p("el-link"),Fe=p("el-dialog"),Ve=Te("loading");return v(),f("div",Ke,[e[18]||(e[18]=s("div",{class:"page-header"},[s("h2",null,"æ–‡æ¡£ç®¡ç†"),s("p",null,"ç®¡ç†çŸ¥è¯†åº“ä¸­çš„æ–‡æ¡£ï¼ŒæŒ‰äº‘åŽ‚å•†å’Œäº§å“åˆ†ç±»ç»„ç»‡")],-1)),s("div",qe,[a(Pe,{gutter:20,align:"middle"},{default:o(()=>[a(g,{span:6},{default:o(()=>[a(C,{modelValue:A.value,"onUpdate:modelValue":e[0]||(e[0]=l=>A.value=l),placeholder:"æœç´¢æ–‡æ¡£...",onInput:_e,clearable:""},{prefix:o(()=>[a(n,null,{default:o(()=>[a(y(Le))]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(g,{span:3},{default:o(()=>[a(ae,{modelValue:T.value,"onUpdate:modelValue":e[1]||(e[1]=l=>T.value=l),placeholder:"é€‰æ‹©äº‘æœåŠ¡å•†",clearable:"",onChange:Y},{default:o(()=>[a(i,{label:"å…¨éƒ¨",value:""}),a(i,{label:"è…¾è®¯äº‘",value:"è…¾è®¯äº‘"}),a(i,{label:"é˜¿é‡Œäº‘",value:"é˜¿é‡Œäº‘"}),a(i,{label:"ç«å±±äº‘",value:"ç«å±±äº‘"}),a(i,{label:"åŽä¸ºäº‘",value:"åŽä¸ºäº‘"}),a(i,{label:"AWS",value:"AWS"}),a(i,{label:"Azure",value:"Azure"}),a(i,{label:"GCP",value:"GCP"})]),_:1},8,["modelValue"])]),_:1}),a(g,{span:3},{default:o(()=>[a(ae,{modelValue:E.value,"onUpdate:modelValue":e[2]||(e[2]=l=>E.value=l),placeholder:"é€‰æ‹©äº§å“åˆ†ç±»",clearable:"",onChange:Y},{default:o(()=>[a(i,{label:"å…¨éƒ¨",value:""}),a(i,{label:"è´Ÿè½½å‡è¡¡",value:"è´Ÿè½½å‡è¡¡"}),a(i,{label:"ç§æœ‰ç½‘ç»œ",value:"ç§æœ‰ç½‘ç»œ"}),a(i,{label:"å¼¹æ€§IP",value:"å¼¹æ€§IP"}),a(i,{label:"NATç½‘å…³",value:"NATç½‘å…³"}),a(i,{label:"ä¸“çº¿",value:"ä¸“çº¿"}),a(i,{label:"äº‘è”ç½‘",value:"äº‘è”ç½‘"}),a(i,{label:"VPN",value:"VPN"})]),_:1},8,["modelValue"])]),_:1}),a(g,{span:6},{default:o(()=>[s("div",Je,[a(x,{type:"primary",onClick:e[3]||(e[3]=l=>t.$router.push("/upload")),icon:y(Me)},{default:o(()=>[...e[7]||(e[7]=[u(" ä¸Šä¼ æ–‡æ¡£ ",-1)])]),_:1},8,["icon"]),a(x,{onClick:fe,loading:B.value,icon:y(Ie)},{default:o(()=>[...e[8]||(e[8]=[u(" åˆ·æ–° ",-1)])]),_:1},8,["loading","icon"])])]),_:1})]),_:1})]),s("div",Oe,[s("div",Qe,[s("div",He,[e[10]||(e[10]=s("div",{class:"tree-header"},[s("h4",null,"äº‘åŽ‚å•†ç›®å½•")],-1)),s("div",Xe,[s("div",{class:U(["provider-node all-documents",{active:_.value.name==="æ‰€æœ‰æ–‡æ¡£"}]),onClick:ie},[a(n,{class:"provider-icon",style:{color:"#409eff"}},{default:o(()=>[a(y(oe))]),_:1}),e[9]||(e[9]=s("span",{class:"provider-name"},"æ‰€æœ‰æ–‡æ¡£",-1)),s("span",Ye,"("+r(D.value.length)+")",1)],2),(v(!0),f(K,null,q(ue.value,l=>(v(),f("div",{key:l.name,class:"provider-section"},[s("div",{class:U(["provider-node",{active:_.value.name===l.name}]),onClick:w=>de(l)},[a(n,{class:U(["expand-icon",{expanded:S.value.has(l.name)}])},{default:o(()=>[a(y(Ge))]),_:1},8,["class"]),a(n,{class:"provider-icon",style:Ne({color:l.color})},{default:o(()=>[a(y(Re))]),_:1},8,["style"]),s("span",et,r(l.name),1),s("span",tt,"("+r(me(l.name))+")",1)],10,Ze),S.value.has(l.name)?(v(),f("div",at,[(v(!0),f(K,null,q(l.products,w=>(v(),f("div",{key:w.name,class:U(["product-node",{active:_.value.name===`${l.name} - ${w.name}`}]),onClick:kt=>ve(l,w)},[s("span",ot,r(w.icon),1),s("span",nt,r(w.name),1),s("span",st,"("+r(pe(l.name,w.name))+")",1)],10,lt))),128))])):V("",!0)]))),128))])]),s("div",rt,[s("div",ut,[s("div",ct,[s("h3",null,r(_.value.name||"æ‰€æœ‰æ–‡æ¡£"),1),s("span",it,r(H.value)+" ä¸ªæ–‡æ¡£",1)]),m.value.length>0?(v(),f("div",dt,[s("span",vt,"å·²é€‰æ‹© "+r(m.value.length)+" ä¸ªæ–‡æ¡£",1),a(x,{type:"danger",size:"small",onClick:ke,loading:R.value,icon:y(ne)},{default:o(()=>[...e[11]||(e[11]=[u(" æ‰¹é‡åˆ é™¤ ",-1)])]),_:1},8,["loading","icon"])])):V("",!0)]),Ae((v(),G(ze,{data:ce.value,stripe:"",style:{width:"100%"},"empty-text":"è¯¥ç›®å½•ä¸‹æš‚æ— æ–‡æ¡£",onSelectionChange:Ce},{default:o(()=>[a(h,{type:"selection",width:"55"}),a(h,{prop:"filename",label:"æ–‡ä»¶å","min-width":"200"},{default:o(({row:l})=>[s("div",mt,[a(n,{class:"file-icon"},{default:o(()=>[a(y(oe))]),_:1}),s("span",pt,r(l.filename),1)])]),_:1}),a(h,{prop:"title",label:"æ ‡é¢˜","min-width":"200","show-overflow-tooltip":""}),a(h,{prop:"provider",label:"äº‘æœåŠ¡å•†",width:"120"},{default:o(({row:l})=>[l.provider?(v(),G(F,{key:0,type:De(l.provider),size:"small"},{default:o(()=>[u(r(l.provider),1)]),_:2},1032,["type"])):(v(),f("span",ft,"-"))]),_:1}),a(h,{prop:"category",label:"åˆ†ç±»",width:"120"},{default:o(({row:l})=>[l.category?(v(),G(F,{key:0,type:"info",size:"small"},{default:o(()=>[u(r(l.category),1)]),_:2},1024)):(v(),f("span",_t,"-"))]),_:1}),a(h,{prop:"file_size",label:"æ–‡ä»¶å¤§å°",width:"100"},{default:o(({row:l})=>[u(r(Z(l.file_size)),1)]),_:1}),a(h,{prop:"word_count",label:"å­—æ•°",width:"100"},{default:o(({row:l})=>[u(r(l.word_count||"-"),1)]),_:1}),a(h,{prop:"status",label:"çŠ¶æ€",width:"100"},{default:o(({row:l})=>[a(F,{type:ee(l.status),size:"small"},{default:o(()=>[u(r(te(l.status)),1)]),_:2},1032,["type"])]),_:1}),a(h,{prop:"created_at",label:"åˆ›å»ºæ—¶é—´",width:"160"},{default:o(({row:l})=>[u(r(j(l.created_at)),1)]),_:1}),a(h,{label:"æ“ä½œ",width:"200",fixed:"right"},{default:o(({row:l})=>[a(x,{size:"small",onClick:w=>ge(l),icon:y(Ue)},{default:o(()=>[...e[12]||(e[12]=[u(" æŸ¥çœ‹ ",-1)])]),_:1},8,["onClick","icon"]),a(x,{size:"small",type:"danger",onClick:w=>he(l),icon:y(ne)},{default:o(()=>[...e[13]||(e[13]=[u(" åˆ é™¤ ",-1)])]),_:1},8,["onClick","icon"])]),_:1})]),_:1},8,["data"])),[[Ve,B.value]]),s("div",gt,[a(xe,{"current-page":z.value,"onUpdate:currentPage":e[4]||(e[4]=l=>z.value=l),"page-size":$.value,"onUpdate:pageSize":e[5]||(e[5]=l=>$.value=l),"page-sizes":[10,20,50,100],total:H.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:be,onCurrentChange:we},null,8,["current-page","page-size","total"])])])])]),a(Fe,{modelValue:N.value,"onUpdate:modelValue":e[6]||(e[6]=l=>N.value=l),title:((le=c.value)==null?void 0:le.title)||"æ–‡æ¡£è¯¦æƒ…",width:"80%","before-close":W},{footer:o(()=>[a(x,{onClick:W},{default:o(()=>[...e[16]||(e[16]=[u("å…³é—­",-1)])]),_:1}),a(x,{type:"primary",onClick:ye},{default:o(()=>[...e[17]||(e[17]=[u("åœ¨çŸ¥è¯†åº“ä¸­æœç´¢",-1)])]),_:1})]),default:o(()=>[c.value?(v(),f("div",ht,[a(Se,{column:2,border:""},{default:o(()=>[a(k,{label:"æ–‡ä»¶å"},{default:o(()=>[u(r(c.value.filename),1)]),_:1}),a(k,{label:"æ–‡ä»¶å¤§å°"},{default:o(()=>[u(r(Z(c.value.file_size)),1)]),_:1}),a(k,{label:"äº‘æœåŠ¡å•†"},{default:o(()=>[u(r(c.value.provider||"-"),1)]),_:1}),a(k,{label:"åˆ†ç±»"},{default:o(()=>[u(r(c.value.category||"-"),1)]),_:1}),a(k,{label:"å­—æ•°"},{default:o(()=>[u(r(c.value.word_count||"-"),1)]),_:1}),a(k,{label:"çŠ¶æ€"},{default:o(()=>[a(F,{type:ee(c.value.status)},{default:o(()=>[u(r(te(c.value.status)),1)]),_:1},8,["type"])]),_:1}),a(k,{label:"åˆ›å»ºæ—¶é—´"},{default:o(()=>[u(r(j(c.value.created_at)),1)]),_:1}),a(k,{label:"æ›´æ–°æ—¶é—´"},{default:o(()=>[u(r(j(c.value.updated_at)),1)]),_:1})]),_:1}),c.value.source_url?(v(),f("div",yt,[e[14]||(e[14]=s("h4",null,"æ¥æºé“¾æŽ¥",-1)),a($e,{href:c.value.source_url,target:"_blank",type:"primary"},{default:o(()=>[u(r(c.value.source_url),1)]),_:1},8,["href"])])):V("",!0),c.value.tags&&c.value.tags.length>0?(v(),f("div",bt,[e[15]||(e[15]=s("h4",null,"æ ‡ç­¾",-1)),(v(!0),f(K,null,q(c.value.tags,l=>(v(),G(F,{key:l,size:"small",style:{"margin-right":"8px","margin-bottom":"8px"}},{default:o(()=>[u(r(l),1)]),_:2},1024))),128))])):V("",!0)])):V("",!0)]),_:1},8,["modelValue","title"])])}}},Ft=je(wt,[["__scopeId","data-v-fd5a2cbd"]]);export{Ft as default};
