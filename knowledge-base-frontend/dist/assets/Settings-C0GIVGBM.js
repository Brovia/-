import{r as H,v as G,z as W,l as s,x as A}from"./element-CPMJgIwH.js";import{k as X,a as j}from"./api-BTqAopYE.js";import{_ as Y}from"./index-DuDiLGTc.js";import{r as x,l as w,h as Z,z as ee,A as te,B as n,R as t,J as l,al as d,O as r,P as g,u as O}from"./vendor-CBsB69ib.js";import"./axios-ngrFHoWO.js";const le={class:"settings-page"},ae={class:"card"},oe={class:"card"},se={class:"card"},ne={class:"card"},re={class:"card"},ie={class:"system-actions"},de={class:"card"},ue={__name:"Settings",setup(ce){const h=x(!1),I=x(!1),k=x(!1),V=x(!1),S=w({apiUrl:"http://localhost:8000"}),c=w({defaultSearchType:"hybrid",defaultLimit:10,minScore:0}),f=w({defaultContextLimit:3,defaultTemperature:.7,defaultIncludeSources:!0}),_=w({version:"1.0.0",buildTime:"2023-12-01",environment:"Development",apiStatus:!1}),y=w({totalDocuments:0,totalChunks:0,providers:0,categories:0,lastUpdated:"-"}),D=async()=>{try{h.value=!0,localStorage.setItem("apiSettings",JSON.stringify(S)),s.success("API设置保存成功")}catch(a){s.error("保存API设置失败"),console.error("Save API settings error:",a)}finally{h.value=!1}},U=async(a=!0,e=!1)=>{var m;try{I.value=!0;const o=await j.healthCheck({showLoading:e}),i=((m=o==null?void 0:o.data)==null?void 0:m.status)==="healthy";_.apiStatus=i,a&&(_.apiStatus?s.success("API连接正常"):s.warning("API连接异常"))}catch(o){_.apiStatus=!1,a&&s.error("API连接失败"),console.error("Test API connection error:",o)}finally{I.value=!1}},J=()=>{try{localStorage.setItem("knowledgeSettings",JSON.stringify(c)),s.success("知识库设置保存成功")}catch(a){s.error("保存知识库设置失败"),console.error("Save knowledge settings error:",a)}},q=()=>{try{localStorage.setItem("qaSettings",JSON.stringify(f)),s.success("问答设置保存成功")}catch(a){s.error("保存问答设置失败"),console.error("Save QA settings error:",a)}},E=async()=>{try{await A.confirm("重建索引可能需要较长时间，确定要继续吗？","确认重建索引",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),k.value=!0,s.info("正在重建索引，请稍候...");const a=await j.reindex();s.success(`索引重建完成！成功处理 ${a.data.indexed_successfully} 个文档`),await P()}catch(a){a!=="cancel"&&(s.error("重建索引失败"),console.error("Rebuild index error:",a))}finally{k.value=!1}},z=async()=>{try{await A.confirm("确定要清除所有缓存吗？","确认清除缓存",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),V.value=!0;const a=["apiSettings","knowledgeSettings","qaSettings"];Object.keys(localStorage).forEach(e=>{a.includes(e)||localStorage.removeItem(e)}),s.success("缓存清除成功")}catch(a){a!=="cancel"&&(s.error("清除缓存失败"),console.error("Clear cache error:",a))}finally{V.value=!1}},K=async()=>{try{await A.confirm("确定要重置所有设置到默认值吗？","确认重置设置",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),Object.assign(S,{apiUrl:"http://localhost:8000"}),Object.assign(c,{defaultSearchType:"hybrid",defaultLimit:10,minScore:0}),Object.assign(f,{defaultContextLimit:3,defaultTemperature:.7,defaultIncludeSources:!0}),localStorage.clear(),s.success("设置重置成功")}catch(a){a!=="cancel"&&(s.error("重置设置失败"),console.error("Reset settings error:",a))}},P=async(a=!1)=>{var e,m;try{const i=(await X.getStats({showLoading:a})).data.vector_store||{},b={totalDocuments:i.total_chunks||0,totalChunks:i.total_chunks||0,providers:((e=i.providers)==null?void 0:e.length)||0,categories:((m=i.categories)==null?void 0:m.length)||0,lastUpdated:new Date().toLocaleString("zh-CN")};Object.assign(y,b)}catch(o){console.error("Fetch data stats error:",o)}},Q=a=>`${(a*100).toFixed(0)}%`,F=()=>{try{const a=localStorage.getItem("apiSettings");a&&Object.assign(S,JSON.parse(a));const e=localStorage.getItem("knowledgeSettings");e&&Object.assign(c,JSON.parse(e));const m=localStorage.getItem("qaSettings");m&&Object.assign(f,JSON.parse(m))}catch(a){console.error("Load settings error:",a)}};return Z(async()=>{F(),await Promise.all([P(!1),U(!1,!1)])}),(a,e)=>{const m=d("el-input"),o=d("el-form-item"),i=d("el-button"),b=d("el-form"),v=d("el-col"),p=d("el-descriptions-item"),M=d("el-tag"),B=d("el-descriptions"),C=d("el-row"),T=d("el-option"),R=d("el-select"),L=d("el-input-number"),N=d("el-slider"),$=d("el-switch");return te(),ee("div",le,[e[21]||(e[21]=n("div",{class:"page-header"},[n("h2",null,"系统设置"),n("p",null,"配置系统参数和API设置")],-1)),t(C,{gutter:20},{default:l(()=>[t(v,{span:12},{default:l(()=>[n("div",ae,[e[10]||(e[10]=n("h3",null,"API设置",-1)),t(b,{model:S,"label-width":"120px"},{default:l(()=>[t(o,{label:"API地址"},{default:l(()=>[t(m,{modelValue:S.apiUrl,"onUpdate:modelValue":e[0]||(e[0]=u=>S.apiUrl=u),placeholder:"http://localhost:8000"},null,8,["modelValue"])]),_:1}),t(o,null,{default:l(()=>[t(i,{type:"primary",onClick:D,loading:h.value},{default:l(()=>[...e[8]||(e[8]=[r(" 保存设置 ",-1)])]),_:1},8,["loading"]),t(i,{onClick:e[1]||(e[1]=()=>U(!0,!0)),loading:I.value},{default:l(()=>[...e[9]||(e[9]=[r(" 测试连接 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])]),_:1}),t(v,{span:12},{default:l(()=>[n("div",oe,[e[11]||(e[11]=n("h3",null,"系统信息",-1)),t(B,{column:1,border:""},{default:l(()=>[t(p,{label:"系统版本"},{default:l(()=>[r(g(_.version),1)]),_:1}),t(p,{label:"构建时间"},{default:l(()=>[r(g(_.buildTime),1)]),_:1}),t(p,{label:"运行环境"},{default:l(()=>[r(g(_.environment),1)]),_:1}),t(p,{label:"API状态"},{default:l(()=>[t(M,{type:_.apiStatus?"success":"danger"},{default:l(()=>[r(g(_.apiStatus?"正常":"异常"),1)]),_:1},8,["type"])]),_:1})]),_:1})])]),_:1})]),_:1}),t(C,{gutter:20},{default:l(()=>[t(v,{span:12},{default:l(()=>[n("div",se,[e[13]||(e[13]=n("h3",null,"知识库设置",-1)),t(b,{model:c,"label-width":"120px"},{default:l(()=>[t(o,{label:"默认搜索类型"},{default:l(()=>[t(R,{modelValue:c.defaultSearchType,"onUpdate:modelValue":e[2]||(e[2]=u=>c.defaultSearchType=u)},{default:l(()=>[t(T,{label:"混合搜索",value:"hybrid"}),t(T,{label:"关键词搜索",value:"keyword"}),t(T,{label:"语义搜索",value:"semantic"})]),_:1},8,["modelValue"])]),_:1}),t(o,{label:"默认结果数量"},{default:l(()=>[t(L,{modelValue:c.defaultLimit,"onUpdate:modelValue":e[3]||(e[3]=u=>c.defaultLimit=u),min:1,max:100},null,8,["modelValue"])]),_:1}),t(o,{label:"最小相似度"},{default:l(()=>[t(N,{modelValue:c.minScore,"onUpdate:modelValue":e[4]||(e[4]=u=>c.minScore=u),min:0,max:1,step:.1,"format-tooltip":Q,"show-input":""},null,8,["modelValue"])]),_:1}),t(o,null,{default:l(()=>[t(i,{type:"primary",onClick:J},{default:l(()=>[...e[12]||(e[12]=[r(" 保存设置 ",-1)])]),_:1})]),_:1})]),_:1},8,["model"])])]),_:1}),t(v,{span:12},{default:l(()=>[n("div",ne,[e[15]||(e[15]=n("h3",null,"问答设置",-1)),t(b,{model:f,"label-width":"120px"},{default:l(()=>[t(o,{label:"默认上下文数量"},{default:l(()=>[t(L,{modelValue:f.defaultContextLimit,"onUpdate:modelValue":e[5]||(e[5]=u=>f.defaultContextLimit=u),min:1,max:10},null,8,["modelValue"])]),_:1}),t(o,{label:"默认温度值"},{default:l(()=>[t(N,{modelValue:f.defaultTemperature,"onUpdate:modelValue":e[6]||(e[6]=u=>f.defaultTemperature=u),min:0,max:2,step:.1,"show-input":""},null,8,["modelValue"])]),_:1}),t(o,{label:"默认显示来源"},{default:l(()=>[t($,{modelValue:f.defaultIncludeSources,"onUpdate:modelValue":e[7]||(e[7]=u=>f.defaultIncludeSources=u)},null,8,["modelValue"])]),_:1}),t(o,null,{default:l(()=>[t(i,{type:"primary",onClick:q},{default:l(()=>[...e[14]||(e[14]=[r(" 保存设置 ",-1)])]),_:1})]),_:1})]),_:1},8,["model"])])]),_:1})]),_:1}),t(C,{gutter:20},{default:l(()=>[t(v,{span:12},{default:l(()=>[n("div",re,[e[19]||(e[19]=n("h3",null,"系统操作",-1)),n("div",ie,[t(i,{type:"warning",onClick:E,loading:k.value,icon:O(H)},{default:l(()=>[...e[16]||(e[16]=[r(" 重建索引 ",-1)])]),_:1},8,["loading","icon"]),t(i,{type:"info",onClick:z,loading:V.value,icon:O(G)},{default:l(()=>[...e[17]||(e[17]=[r(" 清除缓存 ",-1)])]),_:1},8,["loading","icon"]),t(i,{type:"danger",onClick:K,icon:O(W)},{default:l(()=>[...e[18]||(e[18]=[r(" 重置设置 ",-1)])]),_:1},8,["icon"])])])]),_:1}),t(v,{span:12},{default:l(()=>[n("div",de,[e[20]||(e[20]=n("h3",null,"数据统计",-1)),t(B,{column:1,border:""},{default:l(()=>[t(p,{label:"文档总数"},{default:l(()=>[r(g(y.totalDocuments),1)]),_:1}),t(p,{label:"文本块数"},{default:l(()=>[r(g(y.totalChunks),1)]),_:1}),t(p,{label:"云服务商"},{default:l(()=>[r(g(y.providers),1)]),_:1}),t(p,{label:"文档分类"},{default:l(()=>[r(g(y.categories),1)]),_:1}),t(p,{label:"最后更新"},{default:l(()=>[r(g(y.lastUpdated),1)]),_:1})]),_:1})])]),_:1})]),_:1})])}}},Se=Y(ue,[["__scopeId","data-v-40492827"]]);export{Se as default};
